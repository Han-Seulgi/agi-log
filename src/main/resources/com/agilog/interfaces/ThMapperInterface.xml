<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.agilog.interfaces.ThMapperInterface">
	<select id="getCompanyAccessAllInfo" parameterType="com.agilog.beans.CompanyBean" resultType="com.agilog.beans.CompanyBean">
		SELECT CO_CODE AS COCODE,CO_NAME AS CONAME, CO_EMAIL AS COEMAIL, CO_MANAGERCODE AS COMANAGERCODE FROM CO WHERE CO_CODE = #{coCode}
	</select>
	
	<select id="isManagerCode" parameterType="com.agilog.beans.CompanyBean" resultType="int">
		SELECT COUNT(*) FROM CO WHERE CO_MANAGERCODE = #{coManagerCode}
	</select>
	<select id="getResInfo" parameterType="com.agilog.beans.CompanyBean" resultType="com.agilog.beans.ReservationBean">
		SELECT * FROM RESINFO WHERE COCODE = #{coCode}
	</select>
	<update id="updRDRes" parameterType="com.agilog.beans.ReservationBean">
		UPDATE RE SET RE_RCCODE = #{rcCode}, RE_DOCODE = #{resDoCode}
		WHERE RE_CODE = #{resCode} AND RE_DOCOCODE = #{resCoCode}
	</update>
	<update id="updCPRes" parameterType="com.agilog.beans.ReservationBean">
		UPDATE RE SET RE_RCCODE = #{rcCode}
		WHERE RE_CODE = #{resCode} AND RE_DOCOCODE = #{resCoCode}
	</update>
	<select id="getFbCode" parameterType="com.agilog.beans.PostBean" resultType="int">
		SELECT MAX(FB_CODE) FROM FREEBOARD
	</select>
	<insert id="insFbPost" parameterType="com.agilog.beans.PostBean">
		INSERT INTO FREEBOARD(FB_CODE, FB_DATE, FB_SUCODE, FB_TITLE, FB_CONTENT, FB_VIEW, FB_LIKE) 
		VALUES(#{fbCode}, DEFAULT, #{fbSuCode}, #{fbTitle}, #{fbContent}, DEFAULT, DEFAULT)
	</insert>
	<select id="getFbPostList" resultType="com.agilog.beans.PostBean">
		SELECT * FROM FBPOSTLIST
	</select>
	<select id="getFbPostContent" parameterType="com.agilog.beans.PostBean" resultType="com.agilog.beans.PostBean">
		SELECT * FROM FBPOSTCONTENT WHERE FBCODE = #{fbCode}
	</select>
	<select id="getDdCode" parameterType="com.agilog.beans.PostBean" resultType="int">
		SELECT MAX(DD_CODE) FROM DAILYDIARY
	</select>
	<insert id="insDd" parameterType="com.agilog.beans.DailyDiaryBean">
		INSERT INTO DAILYDIARY(DD_CODE, DD_DATE, DD_SUCODE, DD_STATUS, DD_CONTENT, DD_VIEW, DD_LIKE) 
		VALUES(#{ddCode}, DEFAULT, #{suCode}, #{ddStatus}, #{ddContent}, DEFAULT, DEFAULT)
	</insert>
	<select id="getDDFeed" parameterType="com.agilog.beans.DailyDiaryBean" resultType="com.agilog.beans.DailyDiaryBean">
		SELECT * FROM DDVIEW WHERE DDCODE = #{ddCode}
	</select>
	<select id="getDDPhoto" parameterType="com.agilog.beans.DailyDiaryBean" resultType="com.agilog.beans.DailyDiaryBean">
		SELECT DP_LINK AS DPLINK FROM DAILYDIARYPHOTO WHERE DP_DDCODE = #{ddCode}
	</select>
	<update id="updDDFeed" parameterType="com.agilog.beans.DailyDiaryBean">
		UPDATE DAILYDIARY SET DD_CONTENT = #{ddContent}
		WHERE DD_CODE = #{ddCode}
	</update>
	<delete id="delDd" parameterType="com.agilog.beans.DailyDiaryBean">
		DELETE DAILYDIARY
		WHERE DD_CODE = #{ddCode}
	</delete>
	<select id="getResInfoForSms"  parameterType="com.agilog.beans.ReservationBean" resultType="com.agilog.beans.ReservationBean">
        SELECT TO_CHAR(RE_DATE,'YYYY-MM-DD HH:MI') AS RESDATE, SU_CODE AS RESSUCODE, SU_NAME AS RESSUNAME, SU_PHONE AS RESSUPHONE, CO_CODE AS RESCOCODE, CO_NAME AS RESCONAME, BB_NAME AS RESBBNAME, RC_NAME AS RESACTIONNAME, DO_NAME AS RESDONAME
        FROM RE INNER JOIN SU ON RE_BBSUCODE = SU_CODE INNER JOIN CO ON RE_DOCOCODE = CO_CODE
                INNER JOIN BB ON BB_SUCODE = SU_CODE AND BB_CODE = RE_BBCODE
                INNER JOIN RC ON RC_CODE = RE_RCCODE
                INNER JOIN DO ON DO_COCODE = CO_CODE AND DO_CODE = RE_DOCODE
        WHERE RE_CODE = #{resCode}
	</select>
</mapper>